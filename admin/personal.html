<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal - Sunset's Tarbaca</title>
    <link rel="icon" type="image/png" href="/sunsets_logo_b.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/navbar.js"></script>
    <script src="/js/routeProtection.js"></script>
    <script src="/js/footer.js"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        html, body {
            height: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex: 1;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar Container -->
    <div id="navbar-container"></div>

    <!-- Main Content -->
    <div class="main-content">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-gray-800 text-white rounded-lg p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-users mr-3"></i>Gestión de Personal
                    </h1>
                    <p class="text-gray-300">Administra el personal del restaurante</p>
                </div>
                <div class="text-center">
                    <div class="bg-white bg-opacity-10 rounded-lg p-4">
                        <div class="text-2xl font-bold" id="totalEmpleados">-</div>
                        <div class="text-sm text-gray-300">Total Empleados</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-user-check text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-900" id="empleadosActivos">-</h3>
                        <p class="text-gray-600">Empleados Activos</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="bg-red-100 p-3 rounded-full">
                        <i class="fas fa-user-times text-red-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-900" id="empleadosInactivos">-</h3>
                        <p class="text-gray-600">Empleados Inactivos</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-user-shield text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-900" id="administradores">-</h3>
                        <p class="text-gray-600">Administradores</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center">
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-user-tie text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold text-gray-900" id="empleados">-</h3>
                        <p class="text-gray-600">Empleados</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div class="flex items-center space-x-4">
                    <button id="btnNuevoEmpleado" class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2">
                        <i class="fas fa-user-plus"></i>Nuevo Empleado
            </button>
        </div>

                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" id="buscarEmpleado" placeholder="Buscar empleado..." 
                               class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    <select id="filtroEstado" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activos</option>
                        <option value="inactivo">Inactivos</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="overflow-x-auto">
            <table class="min-w-full table-auto">
                <thead class="bg-gray-800 text-white">
                    <tr>
                        <th class="px-6 py-3 text-left text-sm font-semibold">Empleado</th>
                        <th class="px-6 py-3 text-left text-sm font-semibold">Contacto</th>
                        <th class="px-6 py-3 text-left text-sm font-semibold">Rol</th>
                        <th class="px-6 py-3 text-left text-sm font-semibold">Área</th>
                        <th class="px-6 py-3 text-left text-sm font-semibold">Estado</th>
                        <th class="px-6 py-3 text-center text-sm font-semibold">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaEmpleados" class="divide-y divide-gray-200">
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Cargando empleados...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
            </div>
        </div>
        <div id="personalPaginationControls" class="hidden mt-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div id="personalPaginationSummary" class="text-sm text-gray-600">
                Mostrando 0 - 0 de 0 empleados
            </div>
            <div class="flex items-center gap-2">
                <button id="personalPrevPageBtn" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left mr-1"></i> Anterior
                </button>
                <div id="personalPaginationInfo" class="text-sm font-semibold text-gray-700">
                    Página 1 de 1
                </div>
                <button id="personalNextPageBtn" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    Siguiente <i class="fas fa-chevron-right ml-1"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de empleado -->
    <div id="modalEmpleado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitulo" class="text-xl font-semibold text-gray-800">Nuevo Empleado</h3>
                <button type="button" class="modal-close" id="btnCerrarModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formEmpleado">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre Completo *</label>
                        <input type="text" id="nombre" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                               placeholder="Nombre completo del empleado">
                    </div>
                    
                <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Correo Electrónico *</label>
                        <input type="email" id="correo" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                               placeholder="correo@ejemplo.com">
                </div>
                    
                <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono *</label>
                        <input type="tel" id="telefono" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                               placeholder="8888-8888">
                </div>
                    
                <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Área de Trabajo *</label>
                        <select id="area_trabajo" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <option value="">Seleccionar área...</option>
                            <option value="cocina">Cocina</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="postres">Postres</option>
                            <option value="almacen">Almacén</option>
                            <option value="todas">Todas las áreas</option>
                        </select>
                </div>
                    
                <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Usuario *</label>
                        <select id="tipoUsuario" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <option value="">Seleccionar tipo...</option>
                            <option value="Empleado">Empleado</option>
                            <option value="Administrador">Administrador</option>
                        </select>
                </div>
                    
                <div id="contrasenaField">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span id="contrasenaLabel">Contraseña *</span>
                        </label>
                        <input type="password" id="contrasena" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                               placeholder="Contraseña temporal">
                        <p id="contrasenaHelp" class="text-xs text-gray-500 mt-1 hidden">
                            Deja vacío para mantener la contraseña actual
                        </p>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="flex justify-end mt-6">
                    <button type="submit" id="btnGuardar"
                            class="px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-lg hover:shadow-xl font-semibold flex items-center gap-2">
                        <i class="fas fa-plus" id="btnGuardarIcon"></i>
                        <span id="btnGuardarText">Agregar</span>
                        <i id="btnGuardarSpinner" class="fas fa-spinner fa-spin hidden"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
    </div>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <script>
        //Variables globales
        let empleados = [];
        let empleadoEditando = null;
        let empleadosFiltrados = [];
        let empleadosPaginaActual = 1;
        const EMPLEADOS_POR_PAGINA = 8;

        let personalPaginationControls;
        let personalPaginationSummary;
        let personalPaginationInfo;
        let personalPrevPageBtn;
        let personalNextPageBtn;
 
        //Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            loadNavbar('personal');
            inicializarControlesPaginacionPersonal();
            cargarEmpleados();
            cargarEstadisticas();
            setupEventListeners();
        });

        //Configura event listeners
        function setupEventListeners() {
            document.getElementById('btnNuevoEmpleado').addEventListener('click', () => {
                abrirModalEmpleado();
            });


            document.getElementById('btnCerrarModal').addEventListener('click', cerrarModal);

            document.getElementById('formEmpleado').addEventListener('submit', handleSubmitEmpleado);

            document.getElementById('buscarEmpleado').addEventListener('input', filtrarEmpleados);
            document.getElementById('filtroEstado').addEventListener('change', filtrarEmpleados);

            document.getElementById('modalEmpleado').addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    cerrarModal();
                }
            });
        }

        function inicializarControlesPaginacionPersonal() {
            personalPaginationControls = document.getElementById('personalPaginationControls');
            personalPaginationSummary = document.getElementById('personalPaginationSummary');
            personalPaginationInfo = document.getElementById('personalPaginationInfo');
            personalPrevPageBtn = document.getElementById('personalPrevPageBtn');
            personalNextPageBtn = document.getElementById('personalNextPageBtn');

            if (personalPrevPageBtn) {
                personalPrevPageBtn.addEventListener('click', () => cambiarPaginaPersonal(-1));
            }

            if (personalNextPageBtn) {
                personalNextPageBtn.addEventListener('click', () => cambiarPaginaPersonal(1));
            }
        }

        //Carga los empleados desde la API
        async function cargarEmpleados() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    throw new Error('No hay token de autenticación');
                }

                const response = await fetch('/api/empleados', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    empleados = data.data.empleados;
                    empleadosFiltrados = [...empleados];
                    empleadosPaginaActual = 1;
                    renderizarEmpleados();
                } else {
                    throw new Error(data.message || 'Error al cargar empleados');
                }
            } catch (error) {
                console.error('Error al cargar empleados:', error);
                let errorMessage = 'Error al cargar empleados';
                
                if (error.message.includes('No tienes permisos')) {
                    errorMessage = 'No tienes permisos para ver la información de empleados. Solo los administradores pueden acceder a esta sección.';
                } else if (error.message.includes('Token')) {
                    errorMessage = 'Sesión expirada. Por favor, inicia sesión nuevamente.';
                } else if (error.message.includes('servidor')) {
                    errorMessage = 'Error del servidor. Por favor, verifica que la base de datos esté configurada correctamente.';
                } else {
                    errorMessage = 'Error al cargar empleados: ' + error.message;
                }
                
                mostrarError(errorMessage);
                empleados = [];
                empleadosFiltrados = [];
                empleadosPaginaActual = 1;
                renderizarEmpleados();
            }
        }

        //Carga estadísticas
        async function cargarEstadisticas() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    throw new Error('No hay token de autenticación');
                }

                const response = await fetch('/api/empleados/stats', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const stats = data.data;
                    document.getElementById('totalEmpleados').textContent = stats.total_empleados;
                    document.getElementById('empleadosActivos').textContent = stats.empleados_activos;
                    document.getElementById('empleadosInactivos').textContent = stats.empleados_inactivos;
                    document.getElementById('administradores').textContent = stats.administradores;
                    document.getElementById('empleados').textContent = stats.empleados;
                } else {
                    throw new Error(data.message || 'Error al cargar estadísticas');
                }
            } catch (error) {
                console.error('Error al cargar estadísticas:', error);
                document.getElementById('totalEmpleados').textContent = '-';
                document.getElementById('empleadosActivos').textContent = '-';
                document.getElementById('empleadosInactivos').textContent = '-';
                document.getElementById('administradores').textContent = '-';
                document.getElementById('empleados').textContent = '-';
            }
        }

        //Renderiza empleados en la tabla
        function renderizarEmpleados() {
            const tbody = document.getElementById('tablaEmpleados');
 
            if (!empleadosFiltrados || empleadosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            <i class="fas fa-users text-4xl mb-4"></i>
                            <p>No hay empleados registrados</p>
                        </td>
                    </tr>
                `;
                if (personalPaginationControls) {
                    personalPaginationControls.classList.add('hidden');
                }
                return;
            }

            const totalEmpleados = empleadosFiltrados.length;
            const totalPaginas = Math.ceil(totalEmpleados / EMPLEADOS_POR_PAGINA) || 1;

            if (empleadosPaginaActual > totalPaginas) {
                empleadosPaginaActual = totalPaginas;
            }
            if (empleadosPaginaActual < 1) {
                empleadosPaginaActual = 1;
            }

            const inicio = (empleadosPaginaActual - 1) * EMPLEADOS_POR_PAGINA;
            const fin = Math.min(inicio + EMPLEADOS_POR_PAGINA, totalEmpleados);
            const empleadosPagina = empleadosFiltrados.slice(inicio, fin);

            tbody.innerHTML = empleadosPagina.map(empleado => {
                const estadoClass = empleado.estado === 'activo' ? 
                    'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
 
                const rolClass = empleado.tipoUsuario === 'Administrador' ? 
                    'bg-blue-100 text-blue-800' : 'bg-purple-100 text-purple-800';

                const areaIcon = getAreaIcon(empleado.area_trabajo);
                const areaText = getAreaText(empleado.area_trabajo);

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-white"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-900">${empleado.nombre}</div>
                                    <div class="text-sm text-gray-500">ID: ${empleado.id}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-900">${empleado.correo}</div>
                            <div class="text-sm text-gray-500">${empleado.telefono}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${rolClass}">
                                ${empleado.tipoUsuario}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <i class="${areaIcon} mr-2"></i>
                                <span class="text-sm text-gray-900">${areaText}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${estadoClass}">
                                ${empleado.estado === 'activo' ? 'Activo' : 'Inactivo'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="editarEmpleado(${empleado.id})" 
                                        class="text-orange-600 hover:text-orange-700 transition">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="eliminarEmpleado(${empleado.id}, '${empleado.nombre}')" 
                                        class="text-red-600 hover:text-red-700 transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            renderizarControlesPaginacionPersonal(totalEmpleados, inicio, fin, totalPaginas);
        }

        //Filtra empleados
        function filtrarEmpleados() {
            const busqueda = document.getElementById('buscarEmpleado').value.toLowerCase();
            const filtroEstado = document.getElementById('filtroEstado').value;
 
            empleadosFiltrados = empleados.filter(empleado => {
                const coincideBusqueda = empleado.nombre.toLowerCase().includes(busqueda) ||
                                       empleado.correo.toLowerCase().includes(busqueda);
                const coincideEstado = !filtroEstado || empleado.estado === filtroEstado;
                
                return coincideBusqueda && coincideEstado;
            });
 
            empleadosPaginaActual = 1;
            renderizarEmpleados();
         }

        function cambiarPaginaPersonal(offset) {
            irAPaginaPersonal(empleadosPaginaActual + offset);
        }

        function irAPaginaPersonal(pagina) {
            const totalPaginas = Math.ceil((empleadosFiltrados?.length || 0) / EMPLEADOS_POR_PAGINA) || 1;
            if (pagina < 1 || pagina > totalPaginas) {
                return;
            }
            empleadosPaginaActual = pagina;
            renderizarEmpleados();
        }

        function renderizarControlesPaginacionPersonal(totalEmpleados, inicio, fin, totalPaginas) {
            if (!personalPaginationControls || !personalPaginationSummary || !personalPaginationInfo || !personalPrevPageBtn || !personalNextPageBtn) {
                return;
            }

            if (totalEmpleados === 0) {
                personalPaginationControls.classList.add('hidden');
                return;
            }

            personalPaginationControls.classList.remove('hidden');

            personalPaginationSummary.textContent = `Mostrando ${inicio + 1} - ${fin} de ${totalEmpleados} empleados`;
            personalPaginationInfo.textContent = `Página ${empleadosPaginaActual} de ${totalPaginas}`;

            personalPrevPageBtn.disabled = empleadosPaginaActual <= 1;
            personalNextPageBtn.disabled = empleadosPaginaActual >= totalPaginas;
        }

        //Abre el modal para nuevo empleado
        function abrirModalEmpleado() {
            empleadoEditando = null;
            document.getElementById('modalTitulo').textContent = 'Nuevo Empleado';
            document.getElementById('formEmpleado').reset();
            
            const contrasenaField = document.getElementById('contrasena');
            const contrasenaLabel = document.getElementById('contrasenaLabel');
            const contrasenaHelp = document.getElementById('contrasenaHelp');
            
            contrasenaField.required = true;
            contrasenaLabel.textContent = 'Contraseña *';
            contrasenaHelp.classList.add('hidden');
            contrasenaField.placeholder = 'Contraseña temporal';
            
            document.getElementById('btnGuardarText').textContent = 'Agregar';
            document.getElementById('btnGuardarIcon').className = 'fas fa-plus';
            
            const modal = document.getElementById('modalEmpleado');
            modal.classList.add('show');
        }

        //Edita empleado
        function editarEmpleado(id) {
            const empleado = empleados.find(e => e.id === id);
            if (!empleado) {
                mostrarError('Empleado no encontrado');
                return;
            }

            empleadoEditando = empleado;
            document.getElementById('modalTitulo').textContent = 'Editar Empleado';
            
            const contrasenaField = document.getElementById('contrasena');
            const contrasenaLabel = document.getElementById('contrasenaLabel');
            const contrasenaHelp = document.getElementById('contrasenaHelp');
            
            contrasenaField.required = false;
            contrasenaLabel.textContent = 'Nueva Contraseña (opcional)';
            contrasenaHelp.classList.remove('hidden');
            contrasenaField.placeholder = 'Contraseña temporal';
            contrasenaField.value = '';
            
            document.getElementById('nombre').value = empleado.nombre;
            document.getElementById('correo').value = empleado.correo;
            document.getElementById('telefono').value = empleado.telefono;
            document.getElementById('area_trabajo').value = empleado.area_trabajo;
            document.getElementById('tipoUsuario').value = empleado.tipoUsuario;
            document.getElementById('contrasena').value = '';
            document.getElementById('contrasena').required = false;

            document.getElementById('btnGuardarText').textContent = 'Actualizar';
            document.getElementById('btnGuardarIcon').className = 'fas fa-edit';

            const modal = document.getElementById('modalEmpleado');
            modal.classList.add('show');
        }

        //Cierra el modal
        function cerrarModal() {
            const modal = document.getElementById('modalEmpleado');
            modal.classList.remove('show');
            empleadoEditando = null;
            document.getElementById('formEmpleado').reset();
            document.getElementById('contrasena').required = true;
            
            document.getElementById('btnGuardarText').textContent = 'Agregar';
            document.getElementById('btnGuardarIcon').className = 'fas fa-plus';
        }

        //Maneja el envío del formulario
        async function handleSubmitEmpleado(e) {
            e.preventDefault();

            const btnGuardar = document.getElementById('btnGuardar');
            const btnGuardarText = document.getElementById('btnGuardarText');
            const btnGuardarSpinner = document.getElementById('btnGuardarSpinner');

            btnGuardar.disabled = true;
            btnGuardarText.classList.add('hidden');
            document.getElementById('btnGuardarIcon').classList.add('hidden');
            btnGuardarSpinner.classList.remove('hidden');

            try {
                const formData = {
                    nombre: document.getElementById('nombre').value,
                    correo: document.getElementById('correo').value,
                    telefono: document.getElementById('telefono').value,
                    area_trabajo: document.getElementById('area_trabajo').value,
                    tipoUsuario: document.getElementById('tipoUsuario').value
                };

                const contrasena = document.getElementById('contrasena').value;
                if (!empleadoEditando || contrasena.trim() !== '') {
                    formData.contrasena = contrasena;
                }

                const token = localStorage.getItem('authToken');
                if (!token) {
                    throw new Error('No hay token de autenticación');
                }

                let response;
                if (empleadoEditando) {
                    response = await fetch(`/api/empleados/${empleadoEditando.id}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                } else {
                    response = await fetch('/api/empleados', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                }

                const data = await response.json();

                if (data.success) {
                    await Swal.fire({
                        icon: 'success',
                        title: '¡Éxito!',
                        text: empleadoEditando ? 'Empleado actualizado correctamente' : 'Empleado creado correctamente',
                        timer: 2000,
                        showConfirmButton: false
                    });

                    cerrarModal();
                    cargarEmpleados();
                    cargarEstadisticas();
                } else {
                    throw new Error(data.message || 'Error al procesar empleado');
                }
            } catch (error) {
                console.error('Error al procesar empleado:', error);
                await Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message || 'Error al procesar empleado'
                });
            } finally {
                btnGuardar.disabled = false;
                btnGuardarText.classList.remove('hidden');
                document.getElementById('btnGuardarIcon').classList.remove('hidden');
                btnGuardarSpinner.classList.add('hidden');
            }
        }

        //Elimina empleado
        async function eliminarEmpleado(id, nombre) {
            const result = await Swal.fire({
                title: '¿Estás seguro?',
                text: `¿Deseas eliminar al empleado "${nombre}"? Esta acción no se puede deshacer.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            });

            if (result.isConfirmed) {
                try {
                    const token = localStorage.getItem('authToken');
                    if (!token) {
                        throw new Error('No hay token de autenticación');
                    }

                    const response = await fetch(`/api/empleados/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        await Swal.fire({
                            icon: 'success',
                            title: '¡Eliminado!',
                            text: 'Empleado eliminado correctamente',
                            timer: 2000,
                            showConfirmButton: false
                        });

                        window.location.reload();
                    } else {
                        throw new Error(data.message || 'Error al eliminar empleado');
                    }
                } catch (error) {
                    console.error('Error al eliminar empleado:', error);
                    await Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: error.message || 'Error al eliminar empleado'
                    });
                }
            }
        }

        //Funciones auxiliares
        function getAreaIcon(area) {
            const icons = {
                'cocina': 'fas fa-utensils text-orange-500',
                'bebidas': 'fas fa-glass-martini text-blue-500',
                'postres': 'fas fa-birthday-cake text-pink-500',
                'almacen': 'fas fa-boxes text-gray-500',
                'todas': 'fas fa-globe text-green-500'
            };
            return icons[area] || 'fas fa-question text-gray-500';
        }

        function getAreaText(area) {
            const texts = {
                'cocina': 'Cocina',
                'bebidas': 'Bebidas',
                'postres': 'Postres',
                'almacen': 'Almacén',
                'todas': 'Todas las áreas'
            };
            return texts[area] || area;
        }

        function mostrarError(mensaje) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: mensaje
            });
        }
    </script>
</body>
</html>
