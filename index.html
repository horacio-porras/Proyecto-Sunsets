<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunset's Tarbaca - Pizzer√≠a & Restaurante</title>
    <link rel="icon" type="image/png" href="/sunsets_logo_b.png">
    <script src="https://cdn.tailwindcss.com"></script>
   <style>
    .estrella {
        color: lightgray;
        cursor: pointer;
        transition: transform 0.3s, color 0.3s;
    }

    .estrella:hover {
        transform: scale(1.25);
        color: #ffc107;
    }

        .estrella.seleccionada {
            color: #ffc107;
            transform: scale(1.15);
        }
        
        .estrella-restaurante {
            transition: all 0.2s;
        }
        .estrella-restaurante.seleccionada {
            color: #fbbf24;
        }
        .estrella-restaurante:hover {
            color: #fbbf24;
        }
</style>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/navbar.js"></script>
    <script src="/js/footer.js"></script>
    <script src="/js/chatbot.js"></script>
</head>

<body class="bg-gray-50">
    <!-- Navbar Container -->
    <div id="navbar-container"></div>

    <!-- Hero Section -->
    <section class="relative h-96 overflow-hidden">
        <!-- Background Image with Parallax -->
        <div id="hero-background" class="absolute inset-0 bg-cover bg-center bg-no-repeat" style="background-image: url('https://images.unsplash.com/photo-1503803548695-c2a7b4a5b875?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=1470'); transform: scale(1.15);"></div>
        
        <!-- Overlay with transparency and gradient -->
        <div class="absolute inset-0 bg-gray-800 bg-opacity-80"></div>
        
        
        <!-- Content with Parallax -->
        <div id="hero-content" class="relative z-10 text-white h-full flex items-center justify-center">
            <div class="container mx-auto px-4 text-center">
                <div class="mb-2 opacity-0" id="hero-title">
                    <img src="sunsets_logo_b.png" alt="Sunset's Tarbaca" class="mx-auto h-36 md:h-40 lg:h-44">
                </div>
                <p class="text-xl mb-8 max-w-2xl mx-auto opacity-0" id="hero-description">Descubre el sabor aut√©ntico de nuestras pizzas artesanales y platos tradicionales</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center opacity-0" id="hero-buttons">
                    <a href="menu.html" class="bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600 px-8 py-3 rounded-lg font-semibold transition flex items-center justify-center gap-2">
                        <i class="fas fa-utensils"></i>
                        Ver Men√∫
                    </a>
                    <a href="reservaciones.html" class="bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600 px-8 py-3 rounded-lg font-semibold transition flex items-center justify-center gap-2">
                        <i class="fas fa-calendar-alt"></i>
                        Hacer Reservaci√≥n
                    </a>
                </div>
            </div>
        </div>
    </section>


    <!-- Featured Products -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-bold text-center mb-12">Productos Destacados</h3>
            <!-- Loading State -->
            <div id="featured-products-loading" class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"></div>
                <p class="mt-4 text-gray-600">Cargando productos destacados...</p>
            </div>
            <!-- Products Grid -->
            <div id="featured-products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 hidden">
                <!-- Los productos se cargar√°n din√°micamente aqu√≠ -->
            </div>
            <!-- Empty State -->
            <div id="featured-products-empty" class="text-center py-8 hidden">
                <p class="text-gray-600">No hay productos disponibles en este momento.</p>
            </div>
        </div>
    </section>

    <!-- Categories -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-bold text-center mb-12">Explora Nuestras Categor√≠as</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div
                        class="bg-gradient-to-r from-orange-500 to-red-500 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-pizza-slice text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">Pizzas</h4>
                    <p class="text-gray-600">Nuestras pizzas artesanales con ingredientes frescos</p>
                </div>
                <div class="text-center">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-coffee text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">Desayunos</h4>
                    <p class="text-gray-600">Desayunos completos y deliciosos para empezar el d√≠a</p>
                </div>
                <div class="text-center">
                    <div
                        class="bg-gradient-to-r from-orange-500 to-red-500 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-wine-glass text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">Bebidas</h4>
                    <p class="text-gray-600">Frias, calientes, vinos y c√≥cteles especiales</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div>
                    <h3 class="text-3xl font-bold mb-6">Nuestra Historia</h3>
                    <p class="text-gray-600 mb-4">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam a dictum est. Nullam ac dignissim leo. Maecenas libero sem, tempus at purus at, mollis consequat enim. In hac habitasse platea dictumst. Praesent id feugiat urna. Sed eget dolor sed purus viverra cursus a nec elit. Phasellus ultrices commodo elementum.
                    </p>
                    <p class="text-gray-600 mb-6">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam a dictum est. Nullam ac dignissim leo. Maecenas libero sem, tempus at purus at, mollis consequat enim. In hac habitasse platea dictumst. Praesent id feugiat urna. Sed eget dolor sed purus viverra cursus a nec elit. Phasellus ultrices commodo elementum.
                    </p>
                    <a href="about.html"
                        class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-red-600 font-semibold transition">Conoce
                        M√°s</a>
                </div>
                <div>
                    <img src="https://images.unsplash.com/photo-1552566626-52f8b828add9?q=80&w=1740&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Restaurante" class="rounded-lg shadow-lg">
                </div>
            </div>
        </div>
    </section>
    <!-- Secci√≥n de Opiniones -->
    <section class="py-20 bg-gray-50">
        <div class="container mx-auto px-4">
            <h3 class="text-4xl font-bold text-center mb-12 tracking-tight">
                Opiniones de Nuestros Clientes
            </h3>

            <!-- Carrusel de Opiniones -->
            <div class="mb-16">
                <div id="opinionesCarrusel" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Las opiniones se cargar√°n din√°micamente aqu√≠ -->
                </div>
            </div>

            <!-- Formulario de Opini√≥n del Restaurante -->
            <div class="bg-white p-8 rounded-2xl shadow-xl border border-gray-200 max-w-2xl mx-auto">
                <h4 class="text-2xl font-semibold mb-6 text-center">¬øQu√© opinas de nuestro restaurante?</h4>
                <form id="opinionRestauranteForm" class="space-y-6">
                    <div>
                        <label class="font-semibold block text-gray-700 mb-2 text-center">Calificaci√≥n</label>
                        <div id="estrellasRestaurante" class="flex gap-2 text-4xl justify-center">
                            <span class="estrella-restaurante cursor-pointer text-gray-300 hover:text-yellow-400 transition" 
                                  onclick="seleccionarEstrellaRestaurante(1)" 
                                  onmouseover="pintarEstrellasRestaurante(1)" 
                                  onmouseout="pintarEstrellasRestaurante(calificacionRestaurante)">‚òÖ</span>
                            <span class="estrella-restaurante cursor-pointer text-gray-300 hover:text-yellow-400 transition" 
                                  onclick="seleccionarEstrellaRestaurante(2)" 
                                  onmouseover="pintarEstrellasRestaurante(2)" 
                                  onmouseout="pintarEstrellasRestaurante(calificacionRestaurante)">‚òÖ</span>
                            <span class="estrella-restaurante cursor-pointer text-gray-300 hover:text-yellow-400 transition" 
                                  onclick="seleccionarEstrellaRestaurante(3)" 
                                  onmouseover="pintarEstrellasRestaurante(3)" 
                                  onmouseout="pintarEstrellasRestaurante(calificacionRestaurante)">‚òÖ</span>
                            <span class="estrella-restaurante cursor-pointer text-gray-300 hover:text-yellow-400 transition" 
                                  onclick="seleccionarEstrellaRestaurante(4)" 
                                  onmouseover="pintarEstrellasRestaurante(4)" 
                                  onmouseout="pintarEstrellasRestaurante(calificacionRestaurante)">‚òÖ</span>
                            <span class="estrella-restaurante cursor-pointer text-gray-300 hover:text-yellow-400 transition" 
                                  onclick="seleccionarEstrellaRestaurante(5)" 
                                  onmouseover="pintarEstrellasRestaurante(5)" 
                                  onmouseout="pintarEstrellasRestaurante(calificacionRestaurante)">‚òÖ</span>
                        </div>
                    </div>

                    <textarea id="comentarioRestaurante" 
                              placeholder="Escribe tu comentario sobre el restaurante..."
                              rows="4"
                              class="w-full p-4 border rounded-xl shadow-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition"></textarea>

                    <button type="button" onclick="enviarOpinionRestaurante()"
                            class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-xl font-semibold transition hover:scale-[1.02]">
                        Enviar Opini√≥n
                    </button>
                </form>
            </div>
        </div>
    </section>



    <!-- Contact Info -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-bold text-center mb-12">Informaci√≥n de Contacto</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div
                        class="bg-gradient-to-r from-orange-500 to-red-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-map-marker-alt text-white text-xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">Ubicaci√≥n</h4>
                    <p class="text-gray-600">San Jos√©, Costa Rica<br>Tarbaca</p>
                </div>
                <div class="text-center">
                    <div
                        class="bg-gradient-to-r from-orange-500 to-red-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-clock text-white text-xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">Horarios</h4>
                    <p class="text-gray-600">Mi√©rcoles - Domingo<br>12:00 PM - 08:00 PM</p>
                </div>
                <div class="text-center">
                    <div
                        class="bg-gradient-to-r from-orange-500 to-red-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-phone text-white text-xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">Contacto</h4>
                    <p class="text-gray-600">+506 6171-4020<br>sunsetstarbaca@gmail.com</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- ChatBot -->
    <div class="fixed bottom-4 right-4 z-50">
        <button id="chatbotButton" onclick="toggleChatbot()" class="bg-gradient-to-r from-orange-500 to-red-500 text-white w-14 h-14 rounded-full shadow-lg hover:from-orange-600 hover:to-red-600 transition flex items-center justify-center">
            <i class="fas fa-comments text-xl"></i>
        </button>
    </div>

    <!-- Modal del Chatbot -->
    <div id="chatbotModal" class="fixed bottom-4 right-4 z-50 hidden w-full max-w-md h-[600px] flex flex-col">
        <div class="bg-white rounded-lg shadow-2xl w-full h-full flex flex-col">
            <!-- Header del Chatbot -->
            <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-t-lg flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <i class="fas fa-robot text-xl"></i>
                    <h3 class="font-semibold text-lg">Asistente Virtual</h3>
                </div>
                <button onclick="toggleChatbot()" class="text-white hover:text-gray-200 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- √Årea de mensajes -->
            <div id="chatbotMessages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                <div class="flex items-start gap-2">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-sm"></i>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-[80%]">
                        <p class="text-gray-800">¬°Hola! üëã Soy el asistente virtual de Sunset's Tarbaca. ¬øEn qu√© puedo ayudarte hoy?</p>
                    </div>
                </div>
            </div>
            
            <!-- Input de mensaje -->
            <div class="p-4 border-t bg-white rounded-b-lg">
                <form id="chatbotForm" class="flex gap-2">
                    <input 
                        type="text" 
                        id="chatbotInput" 
                        placeholder="Escribe tu mensaje..." 
                        class="flex-1 border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500"
                        autocomplete="off"
                    >
                    <button 
                        type="submit" 
                        class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-red-600 transition"
                    >
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <style>
        /* Efecto de pulse para el bot√≥n de chatbot */
        #chatbotButton {
            transition: transform 0.3s ease, opacity 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        /* Animaci√≥n para el modal del chatbot */
        #chatbotModal {
            animation: slideUp 0.3s ease-out;
        }
        
        #chatbotModal.hidden {
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
        }
        
        /* Responsive: en m√≥viles el modal ocupa m√°s espacio */
        @media (max-width: 640px) {
            #chatbotModal {
                bottom: 0;
                right: 0;
                left: 0;
                max-width: 100%;
                height: 80vh;
                border-radius: 1rem 1rem 0 0;
            }
        }
        
        /* Efecto de parallax para el fondo del hero */
        #hero-background {
            transform: translateZ(0) scale(1.15);
            will-change: transform;
            min-height: 130%;
        }
        
        #hero-content {
            transform: translateZ(0);
            will-change: transform;
        }
        
        #hero-title, #hero-description, #hero-buttons {
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            transform: translateY(30px);
        }
        
        #hero-title.animate-in {
            opacity: 1;
            transform: translateY(0);
        }
        
        #hero-description.animate-in {
            opacity: 1;
            transform: translateY(0);
            transition-delay: 0.2s;
        }
        
        #hero-buttons.animate-in {
            opacity: 1;
            transform: translateY(0);
            transition-delay: 0.4s;
        }
        
        @keyframes pulseAdd {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>

    <script>
        //Parallax Effect
        document.addEventListener('DOMContentLoaded', function() {
            const heroBackground = document.getElementById('hero-background');
            const heroContent = document.getElementById('hero-content');
            const heroTitle = document.getElementById('hero-title');
            const heroDescription = document.getElementById('hero-description');
            const heroButtons = document.getElementById('hero-buttons');
            
            setTimeout(() => {
                heroTitle.classList.add('animate-in');
                heroDescription.classList.add('animate-in');
                heroButtons.classList.add('animate-in');
            }, 500);
            
            function updateParallax() {
                const scrolled = window.pageYOffset;
                const rate = scrolled * 0.15;
                const contentRate = scrolled * -0.05;
                
                if (heroBackground) {
                    heroBackground.style.transform = `translateY(${rate}px) scale(1.15)`;
                }
                
                if (heroContent) {
                    heroContent.style.transform = `translateY(${contentRate}px)`;
                }
            }
            
            let ticking = false;
            function requestTick() {
                if (!ticking) {
                    requestAnimationFrame(updateParallax);
                    ticking = true;
                    setTimeout(() => {
                        ticking = false;
                    }, 16);
                }
            }
            
            window.addEventListener('scroll', requestTick);
            
            window.addEventListener('resize', function() {
                updateParallax();
            });
        });
        
        function toggleChatbot() {
            const modal = document.getElementById('chatbotModal');
            if (modal) {
                modal.classList.toggle('hidden');
                modal.classList.toggle('flex');
                if (!modal.classList.contains('hidden')) {
                    document.getElementById('chatbotInput')?.focus();
                }
            }
        }
    </script>
    
    <script>
        // Sistema de opiniones del restaurante
        let calificacionRestaurante = 0;

        // Funci√≥n para verificar si el usuario es admin o empleado
        function isAdminOrEmployee() {
            const userData = localStorage.getItem('userData');
            if (!userData) return false;
            
            try {
                const user = JSON.parse(userData);
                return user.tipoUsuario === 'Administrador' || user.tipoUsuario === 'Empleado';
            } catch (error) {
                return false;
            }
        }

        // Cargar opiniones del restaurante para el carrusel
        async function cargarOpinionesCarrusel() {
            try {
                const response = await fetch('/api/opiniones/restaurante?limit=6');
                const data = await response.json();
                
                if (data.success && data.opiniones) {
                    const carrusel = document.getElementById('opinionesCarrusel');
                    if (!carrusel) return;
                    
                    if (data.opiniones.length === 0) {
                        carrusel.innerHTML = `
                            <div class="col-span-full text-center text-gray-500 py-8">
                                <p>A√∫n no hay opiniones. S√© el primero en comentar.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    carrusel.innerHTML = data.opiniones.map(opinion => {
                        const estrellas = '‚òÖ'.repeat(opinion.calificacion) + '‚òÜ'.repeat(5 - opinion.calificacion);
                        const fecha = new Date(opinion.fecha_opinion).toLocaleDateString('es-ES');
                        const tipoTexto = opinion.tipo_opinion === 'restaurante' 
                            ? 'Restaurante' 
                            : (opinion.nombre_producto || 'Producto');
                        
                        return `
                            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition">
                                <div class="flex items-center mb-3 text-yellow-400 text-xl">
                                    ${estrellas}
                                </div>
                                <p class="text-gray-700 mb-4">${opinion.comentario || 'Sin comentario'}</p>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="font-semibold text-gray-800">${opinion.nombre_cliente || 'Cliente'}</span>
                                    <span class="text-gray-500">${fecha}</span>
                                </div>
                                ${opinion.tipo_opinion === 'producto' && opinion.nombre_producto 
                                    ? `<div class="mt-2 text-xs text-gray-500">Sobre: ${opinion.nombre_producto}</div>` 
                                    : ''}
                            </div>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('Error al cargar opiniones:', error);
            }
        }

        window.seleccionarEstrellaRestaurante = function(valor) {
            calificacionRestaurante = valor;
            pintarEstrellasRestaurante(valor);
        };

        window.pintarEstrellasRestaurante = function(valor) {
            const estrellas = document.querySelectorAll('#estrellasRestaurante .estrella-restaurante');
            estrellas.forEach((e, index) => {
                if (index < valor) {
                    e.classList.add('seleccionada');
                } else {
                    e.classList.remove('seleccionada');
                }
            });
        };

        window.enviarOpinionRestaurante = async function() {
            // Verificar si el usuario es admin o empleado
            if (isAdminOrEmployee()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Acceso restringido',
                    text: 'Los administradores y empleados no pueden dejar opiniones sobre el restaurante.',
                    confirmButtonColor: '#f97316',
                    confirmButtonText: 'Entendido'
                });
                return;
            }

            const token = localStorage.getItem('authToken') || localStorage.getItem('token');
            
            if (!token) {
                Swal.fire({
                    icon: 'info',
                    title: 'Inicia sesi√≥n',
                    text: 'Debes iniciar sesi√≥n para dejar una opini√≥n',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#f97316'
                });
                return;
            }
            
            if (calificacionRestaurante === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Calificaci√≥n requerida',
                    text: 'Por favor selecciona una calificaci√≥n',
                    confirmButtonColor: '#f97316'
                });
                return;
            }
            
            // Verificar si puede opinar
            try {
                const verifyResponse = await fetch('/api/opiniones/verificar/restaurante', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const verifyData = await verifyResponse.json();
                
                if (!verifyData.success || !verifyData.puedeOpinar) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'No puedes opinar',
                        text: verifyData.razon || 'No puedes opinar sobre el restaurante',
                        confirmButtonColor: '#f97316'
                    });
                    return;
                }
            } catch (error) {
                console.error('Error al verificar:', error);
            }
            
            const comentario = document.getElementById('comentarioRestaurante').value.trim();
            
            try {
                const response = await fetch('/api/opiniones', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        calificacion: calificacionRestaurante,
                        comentario: comentario,
                        tipo_opinion: 'restaurante'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: '¬°Opini√≥n enviada!',
                        text: 'Tu opini√≥n ser√° revisada antes de ser publicada',
                        confirmButtonColor: '#f97316'
                    });
                    
                    // Limpiar formulario
                    calificacionRestaurante = 0;
                    pintarEstrellasRestaurante(0);
                    document.getElementById('comentarioRestaurante').value = '';
                    
                    // Recargar carrusel
                    cargarOpinionesCarrusel();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.mensaje || 'No se pudo enviar la opini√≥n',
                        confirmButtonColor: '#f97316'
                    });
                }
            } catch (error) {
                console.error('Error al enviar opini√≥n:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'No se pudo enviar la opini√≥n',
                    confirmButtonColor: '#f97316'
                });
            }
        };

        // Cargar productos destacados (los 4 mejor calificados)
        async function cargarProductosDestacados() {
            const loadingElement = document.getElementById('featured-products-loading');
            const gridElement = document.getElementById('featured-products-grid');
            const emptyElement = document.getElementById('featured-products-empty');
            
            try {
                // Obtener todos los productos
                const response = await fetch('/api/menu/products');
                const data = await response.json();
                
                if (!data.success || !data.data || data.data.length === 0) {
                    loadingElement.classList.add('hidden');
                    emptyElement.classList.remove('hidden');
                    return;
                }
                
                const productos = data.data;
                
                // Obtener calificaciones para cada producto
                const productosConCalificaciones = await Promise.all(
                    productos.map(async (producto) => {
                        try {
                            const ratingResponse = await fetch(`/api/opiniones/producto/${producto.id}/promedio`);
                            const ratingData = await ratingResponse.json();
                            
                            return {
                                ...producto,
                                promedio: ratingData.success && ratingData.promedio > 0 ? ratingData.promedio : 0,
                                totalOpiniones: ratingData.success ? (ratingData.total || 0) : 0
                            };
                        } catch (error) {
                            console.error(`Error al cargar calificaci√≥n para producto ${producto.id}:`, error);
                            return {
                                ...producto,
                                promedio: 0,
                                totalOpiniones: 0
                            };
                        }
                    })
                );
                
                // Filtrar solo productos con calificaciones (promedio > 0) y ordenar por calificaci√≥n descendente
                const productosCalificados = productosConCalificaciones
                    .filter(p => p.promedio > 0)
                    .sort((a, b) => b.promedio - a.promedio)
                    .slice(0, 4); // Tomar los 4 mejores
                
                // Si no hay productos calificados, mostrar los primeros 4 productos disponibles
                const productosAMostrar = productosCalificados.length > 0 
                    ? productosCalificados 
                    : productos.slice(0, 4);
                
                loadingElement.classList.add('hidden');
                
                if (productosAMostrar.length === 0) {
                    emptyElement.classList.remove('hidden');
                    return;
                }
                
                emptyElement.classList.add('hidden');
                gridElement.classList.remove('hidden');
                
                // Renderizar productos
                gridElement.innerHTML = productosAMostrar.map(producto => {
                    const precioFinal = producto.hasDiscount ? producto.finalPrice : producto.price;
                    const precioFormateado = precioFinal.toLocaleString('es-CR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                    
                    const estrellasLlenas = Math.floor(producto.promedio || 0);
                    const tieneMedia = (producto.promedio || 0) % 1 >= 0.5;
                    const estrellasVacias = 5 - estrellasLlenas - (tieneMedia ? 1 : 0);
                    const ratingHtml = producto.promedio > 0
                        ? `
                            <div class="flex items-center text-yellow-500">
                                <div class="flex">
                                    ${'‚òÖ'.repeat(estrellasLlenas)}${tieneMedia ? '‚òÜ' : ''}${'‚òÜ'.repeat(estrellasVacias)}
                                </div>
                                <span class="text-gray-600 ml-1 text-sm">${producto.promedio.toFixed(1)}</span>
                                ${producto.totalOpiniones > 0 ? `<span class="text-gray-500 ml-1 text-xs">(${producto.totalOpiniones})</span>` : ''}
                            </div>
                        `
                        : `
                            <div class="flex items-center text-gray-400">
                                <i class="fas fa-star"></i>
                                <span class="text-gray-400 ml-1 text-sm">Sin calificaciones</span>
                            </div>
                        `;
                    
                    const imagenUrl = producto.image || 'https://images.unsplash.com/photo-1600028068383-ea11a7a101f3?w=400';
                    const descripcion = producto.description || 'Delicioso producto de nuestro men√∫';
                    
                    return `
                        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition cursor-pointer" onclick="window.location.href='/menu.html'">
                            <img src="${imagenUrl}" alt="${producto.name}"
                                class="w-full h-48 object-cover">
                            <div class="p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-lg">${producto.name}</h4>
                                    <span class="text-orange-600 font-bold text-base">‚Ç°${precioFormateado}</span>
                                </div>
                                <p class="text-gray-600 text-sm mb-4 line-clamp-2">${descripcion}</p>
                                ${ratingHtml}
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error al cargar productos destacados:', error);
                loadingElement.classList.add('hidden');
                emptyElement.classList.remove('hidden');
            }
        }

        // Cargar opiniones al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            cargarOpinionesCarrusel();
            cargarProductosDestacados();
        });
    </script>
</body>

</html>